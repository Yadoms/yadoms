<link href="../css/qrcode.css" rel="stylesheet">

<!--QRCode Modal -->
<div class="modal fade" id="delete-page-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
   <div class="modal-dialog">
       <div class="modal-content">
           <div class="modal-header">
               <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
               <h4 class="modal-title" id="myModalLabel">Delete Page confirmation</h4>
           </div>
           <div class="modal-body">
               <p>You will delete page <span id="name-delete-page-modal"></span> and all of its widgets. Continue anyway ?</p>
           </div>
           <div class="modal-footer">
              <button type="button" class="btn btn-default" data-dismiss="modal">Cancel</button>
              <button id="btn-confirm-delete-page" type="button" class="btn btn-primary">Confirm</button>
           </div>
       </div>
   </div>
</div>
<script>
   //we indicate that delete_page.html has been loaded
   deletePageModalHasBeenLoaded = true;

   var pageToDelete = undefined;

   function showDeletePageModal(pageId) {
      assert(pageId !== undefined, "Page Id must be defined");
      pageToDelete = pageArray[pageId];

      $("span#name-delete-page-modal").text(pageToDelete.name);

      //we display the modal
      $('div#delete-page-modal').modal();
   }

   /**
    * Callback to the click of the button to confirm deletion of a page
    */
   $("button#btn-confirm-delete-page").click(function () {

      assert(pageToDelete !== undefined, "Page must be defined");

      //we close the new widget modal
      $("div#delete-page-modal").modal("hide");
      //we ask for deletion of the page
      $.ajax({
         type: "DELETE",
         url: "/rest/page/" + pageToDelete.id,
         dataType: "json"
      })
      .done(function(data) {
         //we parse the json answer
         if (data.result != "true")
         {
           notifyError("Error during deleting page");
           return;
         }

         //we delete the page dynamically
         pageToDelete.$tab.remove();
         pageToDelete.$content.remove();
         pageArray.splice(pageToDelete.id, 1);
         ensureOnePageIsSelected();
      })
      .fail(function(pageName) { return function() {notifyError("Unable to delete page " + pageName)}}(pageToDelete.name))
      .always(function() {
        //we clear the current id
        pageToDelete = undefined;
      });
   });
</script>
<!DOCTYPE html>
<html lang="fr">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Yet Another DOMotic System">
    <meta name="author" content="yadoms team">
    <link rel="shortcut icon" href="assets/ico/favicon.png">

    <title>Yadoms</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="yadoms.css" rel="stylesheet">
	<link href="css/font-awesome.min.css" rel="stylesheet">

   <link rel="stylesheet" type="text/css" href="http://fonts.googleapis.com/css?family=FontName">
   
    <!-- Just for debugging purposes. Don't actually copy this line! -->
    <!--[if lt IE 9]><script src="../../docs-assets/js/ie8-responsive-file-warning.js"></script><![endif]-->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]-->

      <!-- Gridster includes -->
      <link href="css/jquery.gridster.css" rel="stylesheet">
  </head>

  <body>

  <!-- Fixed navbar -->
  <div class="navbar navbar-default navbar-static-top" role="navigation">
      <div class="container">
          <div class="row" id="mainNavBar">
              <div class="col-md-12">
                  <div class="navbar-header">
                      <a class="navbar-brand" href="#">Yadoms</a>
                  </div>
                  <div class="navbar-collapse collapse">
                      <ul class="nav navbar-nav">
                          <li class="dropdown">
                              <a href="#" class="dropdown-toggle btn btn-inverse" data-toggle="dropdown"><i class="caret"></i></a>
                              <ul class="dropdown-menu">
                                  <li><a href="#">Configuration</a></li>
                                  <li><a href="#">Check For Update</a></li>
                                  <li><a href="#">...</a></li>
                                  <li class="divider"></li>
                                  <li class="dropdown-header">Shutdown/Restart</li>
                                  <li><a href="#">Shutdown</a></li>
                                  <li><a href="#">Restart</a></li>
                              </ul>
                          </li>
                      </ul>
                      <ul class="nav navbar-nav navbar-right">
                          <li><a href="#" class="btn btn-inverse" id="customizeButton"><i class="fa fa-wrench"></i></a></li>
                      </ul>
                      </div>
                  </div>
              </div>
          <div class="row">
              <div class="col-md-12">
                  <div class="nav navbar-nav" id = "pageMenu">
                      <ul class="nav nav-pills nav-justified">
                          <li class="active"><a href="#tab0" data-toggle="tab">Partie Jour</a></li>
                          <li><a href="#tab1" data-toggle="tab">Partie Nuit</a></li>
                          <li><a href="#tab2" data-toggle="tab">Cameras</a></li>
                      </ul>
                  </div>
              </div>
          </div>
          </div><!--/.nav-collapse -->
      </div>
  </div>

  <div id="tabContainer">
      <div class="tab-content">
          <div class="widgetPage tab-pane active" id="tab0">
              <div class="gridster">
                  <ul>


                  </ul>
              </div>
          </div>

          <div class="widgetPage tab-pane active" id="tab1">
              <div class="gridster">
                  <ul>
                      <li data-row="1" data-col="1" data-sizex="1" data-sizey="1"></li>
                      <li data-row="2" data-col="1" data-sizex="1" data-sizey="1"></li>
                      <li data-row="3" data-col="1" data-sizex="1" data-sizey="1"></li>

                      <li data-row="1" data-col="4" data-sizex="3" data-sizey="2"></li>

                  </ul>
              </div>
          </div>

          <div class="widgetPage tab-pane active" id="tab2">
              <div class="gridster">
                  <ul>
                      <li data-row="1" data-col="1" data-sizex="3" data-sizey="3" id="0"></li>
                      <li data-row="4" data-col="1" data-sizex="3" data-sizey="3" id="1"></li>
                      <li data-row="1" data-col="4" data-sizex="3" data-sizey="3" id="2"></li>
                      <li data-row="4" data-col="4" data-sizex="3" data-sizey="3" id="3"></li>
                      <li data-row="1" data-col="7" data-sizex="3" data-sizey="3" id="4"></li>
                      <li data-row="4" data-col="7" data-sizex="3" data-sizey="3" id="5"></li>
                  </ul>
              </div>
          </div>
      </div>

      <footer class="footer"><p>&copy; Yadoms 2014</p></footer>

  </div>

  <div data-bind="template: { name: 'temperature-template', data: widget9 }"></div>


    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
    <script src="js/jquery-1.10.2.min.js"></script>
    <script src="js/bootstrap.min.js"></script>

    <script src="js/jquery.getCSS.js"></script>
    
    <!-- Gridster includes -->
    <!--TODO: reprendre la version min-->
    <script src="js/jquery.gridster.js"></script>
    
	<script src="js/jquery.transit.min.js"></script>
	<script src="js/knockout-3.0.0.js"></script>

    <script type="text/html" id="templates"></script>

	<script type="text/javascript">
	
	//var declaration
	var customization = false;
	var gridsterTab0;
    var v;
    var widgetArray = {};

	$( document ).ready(function() {

        var numberOfColumns = 9;
        var gridWidth = 100;
        var gridMargin = 5;

        //gridster implemntation
        $(".gridster ul").gridster({
            widget_margins: [gridMargin, gridMargin],
            widget_base_dimensions: [gridWidth, gridWidth],
            min_cols: numberOfColumns,
            max_cols: numberOfColumns,
            resize: {
               enabled: true,
               stop: function(e, ui, $widget) {
                  
               }
            }
            
        });

        $(".widgetPage .gridster").width(numberOfColumns * (gridWidth + gridMargin * 2));

        $("#tab1").removeClass("active");
        $("#tab2").removeClass("active");

        gridsterTab0 = $("#tab0 ul").gridster().data('gridster');

        //gridsterTab0.add_widget("<li id=\"widget0\"/>", 1, 1, 1, 1);
        gridsterTab0.add_widget("<li id=\"widget1\"/>", 1, 1, 2, 1);
        gridsterTab0.add_widget("<li id=\"widget2\"/>", 2, 2, 3, 1);
        
        gridsterTab0.disable();
        gridsterTab0.disable_resize();

        //on recupere les widgets depuis le REST

        $.getJSON( "/rest/widget", function( data ) {
            //we parse the json answer
            $.each(data.widget, function(index, value) {
                widgetArray[value.id] = value;
            });

            //we parse widgetArray
            $.each(widgetArray, function (index, value) {
                //for each widget we add viewModelData of the widget into the template section

                $.get( "widgets/" + value.path + "/view.html", function( data ) {
                    $("#templates").append(data);
                });

                $.getScript( "widgets/" + value.path + "/viewModel.js", function(data, textStatus, jqxhr) {
                    value.viewModel = temperatureViewModel;
                    gridsterTab0.add_widget("<li id=\"widget" + value.id + "\" data-bind=\"template: { name: '" + value.path + "-template', data: " + value.viewModel.data + " }\"/>", 1, 1, 1, 1);
                });



                //ko.applyBindings(v);
            })
        });
/*
        $.get( "widgets/temperature/view.html", function( data ) {
            $("#templates").append(data);
            $("#templates").append(data);
            $("#templates").append(data);
            ko.applyBindings(v);
        });*/

        var ViewModel = function() {
            this.widget8 = ko.observable({ temperature: 24, rssi: 80 });
            this.widget9 = ko.observable({ temperature: '28', rssi: 30 });
        };

        gridsterTab0.add_widget("<li id=\"widget8\" data-bind=\"template: { name: 'temperature-template', data: widget8 }\"/>", 1, 1, 1, 1);

/*
        function MyViewModel() {
            this.widget8 = { temperature: '24', rssi: 80 };
            this.widget9 = { temperature: '28', rssi: 30 };
        }
*/
        v = new ViewModel();

        /*$.get( "widget.html", function( data ) {
           $("#widget0").append(data);
         });
        
        $.get( "widgets/simpleClock/widget.html", function( data ) {
           $("#widget1").append(data);
         });
        */
        //<li data-row="1" data-col="1" data-sizex="1" data-sizey="1"></li>
        //<li data-row="2" data-col="1" data-sizex="1" data-sizey="1"></li>
        //<li data-row="3" data-col="1" data-sizex="1" data-sizey="1"></li>

        //<li data-row="1" data-col="2" data-sizex="2" data-sizey="2"></li>
        //<li data-row="2" data-col="2" data-sizex="2" data-sizey="2"></li>
        //<li data-row="3" data-col="2" data-sizex="1" data-sizey="1"></li>
        //<li data-row="3" data-col="3" data-sizex="1" data-sizey="1"></li>

        //<li data-row="1" data-col="4" data-sizex="3" data-sizey="2"></li>

		// get JSON-formatted data from the server
      //$.getJSON( "/rest/hardware", function( resp ) {
      //   hardwares = resp.hardware;
      //   for(i = 0; i < hardwares.length; i++ )
      //   {
      //      var p = document.createElement('p');
      //      p.innerHTML = '<div class="row"><div class="col-md-4"><b>Hardware name:</b>'+hardwares[i].name+', <p><b>PluginName name: </b>'+ hardwares[i].pluginName + '</p></div></div>';
      //      $('#hardwares').append(p);
      //   }
      //});

	});
	
   var cols = "rotate(-2deg),rotate(2deg)".split(",")
   var cPos = 0


   function animateCustomizeButton() {
		$("#customizeButton i").transition({
		  rotate: '+=30deg',
		  duration: 500,
		  easing: 'linear',
		  complete: function() { 
				if (customization)
					animateCustomizeButton();
				else
					$("#customizeButton i").transition({
						rotate: '0deg',
						duration: 100
					});
			}
		});
   }
   
	$("#customizeButton").click(function() {
		customization = !customization;
		
		if (customization)
		{
			$("#customizeButton").removeClass('btn-inverse').addClass('btn-primary');
			gridsterTab0.enable();
			gridsterTab0.enable_resize();
			//$(".gridster li").addClass("widgetCustomizing");
			//animateWidgetCustomizing();
            v.widget8({ temperature: 32, rssi: 72 });
            animateCustomizeButton();

        }
		else
		{
			$("#customizeButton").removeClass('btn-primary').addClass('btn-inverse');
			gridsterTab0.disable();
			gridsterTab0.disable_resize();
			//$(".gridster li").removeClass("widgetCustomizing");
            v.widget8({ temperature: 78, rssi: 22 });
			
		}
		
	});
	
	</script>
  </body>
</html>

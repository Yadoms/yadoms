<div id="dashboard-install-update">
   <h1 class="page-header"><span class="glyphicon glyphicon-save">&nbsp;<span data-i18n="modals.dashboard.sub-windows.install-update.title"></span></span></h1>
   <span data-i18n="modals.dashboard.sub-windows.install-update.description"></span><br>

   <h2>
      <span data-i18n="modals.dashboard.sub-windows.install-update.yadoms.title"></span>
      &nbsp;
      <button id="btn-update-yadoms" type="button" class="btn btn-success disabled">
         <span class="fa fa-download"></span>&nbsp;&nbsp;<span data-i18n="modals.dashboard.sub-windows.install-update.yadoms.update"></span>
      </button>
   </h2>

   <table id="software-install-update" class="table table-bordered dashboard-list">
      <tr>
         <td data-i18n="modals.dashboard.sub-windows.install-update.yadoms.currentVersion" class="active"></td>
         <td class="current-version"><em>v1.12 Beta</em></td>
      </tr>
      <tr>
         <td data-i18n="modals.dashboard.sub-windows.install-update.yadoms.availableVersion" class="active"></td>
         <td class="available-version"><em>v1.14 Beta</em></td>
      </tr>
   </table>

   <h2 data-i18n="modals.dashboard.sub-windows.install-update.plugins.title"></h2>

   <table id="plugin-install-update-list" class="table table-bordered table-striped dashboard-list">
      <tr>
         <td data-i18n="modals.dashboard.sub-windows.install-update.generic.name"></td>
         <td data-i18n="modals.dashboard.sub-windows.install-update.generic.icon"></td>
         <td data-i18n="modals.dashboard.sub-windows.install-update.generic.description"></td>
         <td data-i18n="modals.dashboard.sub-windows.install-update.generic.actualVersion"></td>
         <td data-i18n="modals.dashboard.sub-windows.install-update.generic.availableVersion"></td>
         <td data-i18n="modals.dashboard.sub-windows.install-update.generic.actions"></td>
      </tr>
      <!-- plugins will be listed here-->
      <tr colspan="6" data-i18n="objects.generic.retrievingData"></tr>

      </tr>
   </table>

   <h2 data-i18n="modals.dashboard.sub-windows.install-update.widgets.title"></h2>

   <table id="widget-install-update-list" class="table table-bordered table-striped dashboard-list">
      <tr>
         <td data-i18n="modals.dashboard.sub-windows.install-update.generic.name"></td>
         <td data-i18n="modals.dashboard.sub-windows.install-update.generic.icon"></td>
         <td data-i18n="modals.dashboard.sub-windows.install-update.generic.description"></td>
         <td data-i18n="modals.dashboard.sub-windows.install-update.generic.actualVersion"></td>
         <td data-i18n="modals.dashboard.sub-windows.install-update.generic.availableVersion"></td>
         <td data-i18n="modals.dashboard.sub-windows.install-update.generic.actions"></td>
      </tr>
      <!-- widgets will be listed here-->
      <tr colspan="6" data-i18n="objects.generic.retrievingData"></tr>
   </table>

   <h2 data-i18n="modals.dashboard.sub-windows.install-update.script-interpreters.title"></h2>

   <table id="script-interpreters-install-update-list" class="table table-bordered table-striped dashboard-list">
      <tr>
         <td data-i18n="modals.dashboard.sub-windows.install-update.generic.name"></td>
         <td data-i18n="modals.dashboard.sub-windows.install-update.generic.icon"></td>
         <td data-i18n="modals.dashboard.sub-windows.install-update.generic.description"></td>
         <td data-i18n="modals.dashboard.sub-windows.install-update.generic.actualVersion"></td>
         <td data-i18n="modals.dashboard.sub-windows.install-update.generic.availableVersion"></td>
         <td data-i18n="modals.dashboard.sub-windows.install-update.generic.actions"></td>
      </tr>
      <!-- script interpreters will be listed here-->
      <tr colspan="6" data-i18n="objects.generic.retrievingData"></tr>
   </table>
</div>

<script>

   var pluginList;
   var wantedVersion = ["beta", "testing", "stable"];

   function initializeInstallUpdateDashboard() {
      //we remove all rows except header
      $("table#plugin-install-update-list").find("tr:gt(0)").remove();

      //we launch requests
      PluginManager.get(function(localList) {
         console.log(localList);
         UpdateInformationManager.getPluginList(function(serverList) {
            //we get installed plugin List
            if (serverList) {
               //we merge the two lists
               $.each(serverList, function(serverIndex, serverValue) {
                  //we search it on the other list
                  var itemFound = false;
                  $.each(localList, function(localIndex, localValue) {
                     if (serverValue[0].name.toLowerCase() == localValue.name.toLowerCase()) {
                        //we've found the item
                        itemFound = true;
                        //we add informations of all version that user wants
                        localValue.serverVersions = [];
                        //we browse all version of that item
                        $.each(serverValue, function(versionIndex, versionValue) {
                           //if this releasetype is wanted we add it to the arrays of version for this item
                           if ($.inArray(versionValue.version.toLowerCase(), wantedVersion)) {
                              var item = {};
                              item.downloadUrl = versionValue.downloadUrl;
                              item.version = versionValue.version;
                              item.releaseType = versionValue.releaseType;
                              localValue.serverVersions.push(item);
                           }
                        });
                     }
                  });

                  if (!itemFound) {
                     //we add the new item available only on the server
                     var newItem = {};
                     //generic informations
                     newItem.name = serverValue[0].name;
                     newItem.description = serverValue[0].description;
                     newItem.author = serverValue[0].author;
                     newItem.url = serverValue[0].url;
                     newItem.iconUrl = serverValue[0].iconUrl;

                     //we add informations of all version that user wants
                     newItem.serverVersions = [];
                     //we browse all version of that item
                     $.each(serverValue, function(versionIndex, versionValue) {
                        //if this releasetype is wanted we add it to the arrays of version for this item
                        if ($.inArray(versionValue.version.toLowerCase(), wantedVersion)) {
                           var item = {};
                           item.downloadUrl = versionValue.downloadUrl;
                           item.version = versionValue.version;
                           item.releaseType = versionValue.releaseType;
                           newItem.serverVersions.push(item);
                        }
                     });
                     localList.push(newItem);
                  }
               });
            }

            //we save it
            pluginList = localList;
            //we display the result
            $.each(pluginList, function(localIndex, localValue) {
               localValue.uid = createUUID();
               createInstallUpdateItemLine(localValue)
            });
         });
      });
   }

   function createInstallUpdateItemLine(item) {
      var actionsBtns = "<div class=\"btn-group\">\n";
debugger;
      var s = "<tr id=\"" + item.uid + "\">" +
                  "<td><span>" + item.name + "</span></td>" +
                  "<td><img src=\"" + (item.iconUrl?item.iconUrl:"plugins/" + item.name + "/icon.png") + "\" class=\"img-thumbnail plugin-icon\"></td>" +
                  "<td><span>" + item.description + "</span></td>" +
                  "<td><em>" + (item.version?item.version:"") + " " + (item.releaseType?item.releaseType:"") + "</em></td>" +
                  "<td><em>" + (item.serverVersions?item.serverVersions[0].version + " " + item.serverVersions[0].releaseType:"") + "</em></td>" +
                  "<td>" +
                     "<div class=\"btn-group\">" +
                        "<button type=\"button\" class=\"btn btn-update\" data-i18n=\"[title]modals.dashboard.sub-windows.install-update.generic.update\"><span class=\"glyphicon glyphicon-save\"></span></button>" +
                       "<button type=\"button\" class=\"btn btn-primary btn-install\" data-i18n=\"[title]modals.dashboard.sub-windows.install-update.generic.install\"><span class=\"glyphicon glyphicon-saved\"></span></button>" +
                       "<button type=\"button\" class=\"btn btn-danger btn-uninstall\" data-i18n=\"[title]modals.dashboard.sub-windows.install-update.generic.uninstall\"><span class=\"glyphicon glyphicon-trash\"></span></button>" +
                      "</div>" +
                  "</td>" +
              "</tr>";
      $("table#plugin-install-update-list").append(s);
   }
</script>
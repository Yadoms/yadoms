<!--New plugin Modal -->
<div class="modal fade" id="new-plugin-modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" data-i18n="modals.add-plugin.title"></h4>
            </div>
            <div class="modal-body">
               <form>
                  <div class="form-group">
                     <label for="pluginName" data-i18n="modals.add-plugin.pluginName"></label>
                     <input class="form-control" id="pluginName" data-i18n="[placeholder]modals.add-plugin.enterPluginName">
                  </div>
                  <div class="form-group">
                     <label for="pluginName" data-i18n="modals.add-plugin.pluginType"></label>
                     <select id="pluginTypeList" class="form-control">
                     </select>
                  </div>
               </form>
            </div>
            <div class="modal-footer">
                <button id="btn-get-more-plugin" type="button" class="btn btn-primary pull-left" data-i18n="modals.add-plugin.getMore"></button>
                <button type="button" class="btn btn-default" data-dismiss="modal" data-i18n="common.cancel"></button>
                <button id="btn-confirm-add-plugin" type="button" class="btn btn-primary" data-i18n="common.ok"></button>
            </div>
        </div>
    </div>
</div>

<script>

    var pluginTypes = [];

    /**
     * Ask for plugin types to the REST server
     */
    function askPluginTypes()
    {
       $.getJSON("rest/plugin/")
               .done(requestPluginTypesDone())
               .fail(function() {notifyError($.t("modals.add-plugin.errorDuringGettingPluginTypes"));});
    }

    /**
     * Callback of the request plugin types
     * @returns {Function}
     */
    function requestPluginTypesDone()
    {
       return function( data ) {
          //we parse the json answer
          if (data.result != "true")
          {
             notifyError($.t("modals.add-plugin.errorDuringGettingPluginTypes"), JSON.stringify(data));
             return;
          }

          $("select#pluginTypeList").empty();

          //TODO : rajouter "plugin" une fois que ce sera ajout√© dans le rest
          $.each(data.data, function(index, value) {
             //foreach plugin-type
             $("select#pluginTypeList").append("<option>" + value.name + "</option>");
          });

          //TODO : add jqvalidation form

          $("input#pluginName").text("");

          //we display the modal
          $('div#new-plugin-modal').modal();
       };
    }

    /**
     * Callback to the click of the button to confirm an add of a new plugin
     */
    $("button#btn-confirm-add-plugin").click(function () {

       //we close the new widget modal
       $("div#new-plugin-modal").modal("hide");

       var pluginName = $("input#pluginName").val();
       var pluginType = $("select#pluginTypeList").val();

       $.ajax({
            type: "POST",
            url: "/rest/plugin",
            data: JSON.stringify({ name: pluginName, pluginName: pluginType, configuration: '', enabled: true}),
            contentType: "application/json; charset=utf-8",
            dataType: "json"
       })
       .done(function(data) {
           //we parse the json answer
           if (data.result != "true")
           {
              notifyError($.t("modals.add-plugin.errorDuringCreatingPlugin"), JSON.stringify(data));
              return;
           }

           notifySuccess($.t("modals.add-plugin.pluginSuccessfullyCreated"));
           //we add the plugin dynamically
           var pi = new PluginInstance(data.data.id, data.data.name, data.data.pluginName, data.data.configuration, data.data.enabled);
           addPluginInstanceToDom(pi);
           pluginInstanceList.push(pi);
       })
       .fail(function() {notifyError($.t("modals.add-plugin.errorDuringCreatingPlugin"), JSON.stringify(data));})
    });

</script>